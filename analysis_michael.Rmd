---
title: "analysis_michael"
author: "Michael Wagner"
date: "2023-02-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r}
rm(list=ls())
library(tidyverse)
library(tseries)
library(forecast)
library(TSA)
library(vars)
```

### Load and inspect data

```{r}
# set up generalizable path without local path hard coded
base_path <- system('git rev-parse --show-toplevel', intern = T)

# rental index - one for each of four real boroughs
rental_index_raw <- read.csv(paste0(base_path, '/data/rentalIndex_All.csv'))
# median asking rent - four real boroughs + 155 neighborhoods
median_rent_raw <- read.csv(paste0(base_path, '/data/medianAskingRent_All.csv'))
# rental inventory - four real boroughs + 155 neighborhoods
inventory_raw <- read.csv(paste0(base_path, '/data/rentalInventory_All.csv'))

```

```{r}
rental_index_manhattan <- ts(rental_index_raw$Manhattan,
                             start=c(2007,1),
                             frequency=12)

tsdisplay(rental_index_manhattan)

median_rent_manhattan <- median_rent_raw %>% 
  filter(areaName=="Manhattan") %>%
  unlist() %>% as.numeric() %>% 
  na.omit() %>% 
  ts(start=c(2010,1),frequency=12)

tsdisplay(median_rent_manhattan)

inventory_manhattan <- inventory_raw %>% 
  filter(areaName=="Manhattan") %>% 
  unlist() %>% as.numeric() %>% 
  na.omit() %>%
  ts(start=c(2010,1),frequency=12)

tsdisplay(inventory_manhattan)

rent_train <- window(median_rent_manhattan, start=2010, end=c(2020,1))
inventory_train <- window(inventory_manhattan, start=2010, end=c(2020,1))
rent_test <- window(median_rent_manhattan, start=c(2020,2), end=c(2022,12))
inventory_test <- window(inventory_manhattan, start=c(2020,2), end=c(2022,12))
```

```{r}
inventory_train %>% autoplot()

# log
log(rent_train) %>%
  cbind(log(inventory_train)) %>%
  autoplot()
```
```{r}
#trying transformations
BoxCox(rent_train,lambda='auto') %>% autoplot()
BoxCox(inventory_train,lambda='auto') %>% autoplot()

inventory_train %>% tsdisplay()
#train %>% diff(lag=12, differences = 1) %>% tsdisplay()

BoxCox(inventory_train,lambda='auto') %>% 
  diff(lag=1, differences=1) %>% 
  tsdisplay()
```

```{r}
#regular linear model
tslm(rent_train ~ inventory_train) %>% summary()

tslm(rent_train ~ inventory_train) %>% checkresiduals()
```

```{r}
# log
fit_log <- auto.arima(log(rent_train),
                  #lambda = 'auto',
                  xreg = log(inventory_train))

fit_log %>% summary()

fit <- auto.arima(rent_train,
                  #lambda = 'auto',
                  xreg = inventory_train)

fit %>% summary()
```



```{r}
cbind("Regression Errors" = residuals(fit, type="regression"),
      "ARIMA errors" = residuals(fit, type="innovation")) %>%
  autoplot(facets=TRUE)
```



```{r}

```

